apiVersion: batch/v1
kind: Job
metadata:
  name: nfs-apt-install
spec:
  template:
    spec:
      hostNetwork: true
      hostPID: true
      nodeSelector:
        kubernetes.io/hostname: wsl2-ubuntu
      tolerations:
      - key: workload-type
        operator: Equal
        value: development
        effect: NoSchedule
      containers:
      - name: install
        image: ubuntu:22.04
        command: ["/bin/bash", "-c"]
        args:
        - |
          mkdir -p /host
          mount --bind / /host
          chroot /host bash -c "export DEBIAN_FRONTEND=noninteractive && apt-get update && apt-get install -y nfs-common && which mount.nfs && echo 'NFS-Tools installiert'"
        securityContext:
          privileged: true
          capabilities:
            add:
            - SYS_ADMIN
            - SYS_CHROOT
            - MKNOD
      restartPolicy: Never
  backoffLimit: 1

