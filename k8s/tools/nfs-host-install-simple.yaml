apiVersion: v1
kind: Pod
metadata:
  name: nfs-host-install-simple
  namespace: default
spec:
  hostNetwork: true
  hostPID: true
  nodeSelector:
    kubernetes.io/hostname: wsl2-ubuntu
  tolerations:
  - key: workload-type
    operator: Equal
    value: development
    effect: NoSchedule
  containers:
  - name: installer
    image: ubuntu:22.04
    command: ["/bin/bash", "-c"]
    args:
    - |
      # Bind mount host root
      mkdir -p /host
      mount --bind / /host 2>/dev/null || mount --rbind / /host
      
      # Chroot and install
      chroot /host bash -c "
        export DEBIAN_FRONTEND=noninteractive
        apt-get update
        apt-get install -y nfs-common
        dpkg -l | grep nfs-common
        which mount.nfs
        ls -la /sbin/mount.nfs
      "
      
      echo "Installation abgeschlossen"
      sleep 5
    securityContext:
      privileged: true
      capabilities:
        add:
        - SYS_ADMIN
        - SYS_CHROOT
        - MKNOD
  restartPolicy: Never

