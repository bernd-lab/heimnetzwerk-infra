apiVersion: v1
kind: Pod
metadata:
  name: nfs-direct-install
  namespace: default
spec:
  hostNetwork: true
  hostPID: true
  nodeSelector:
    kubernetes.io/hostname: wsl2-ubuntu
  tolerations:
  - key: workload-type
    operator: Equal
    value: development
    effect: NoSchedule
  containers:
  - name: installer
    image: ubuntu:22.04
    command: ["/bin/bash", "-c"]
    args:
    - |
      # Bind mount host root filesystem
      mkdir -p /host-root
      mount --bind / /host-root || mount --rbind / /host-root
      
      # Chroot into host and install nfs-common
      chroot /host-root /bin/bash -c "
        export DEBIAN_FRONTEND=noninteractive
        apt-get update
        apt-get install -y nfs-common
        echo 'NFS-Tools installiert auf Host'
        which mount.nfs || echo 'mount.nfs nicht gefunden'
        ls -la /sbin/mount.nfs || echo 'Datei nicht gefunden'
      "
      
      # Verify
      if [ -f /host-root/sbin/mount.nfs ]; then
        echo "✅ Verifizierung: mount.nfs existiert auf Host"
      else
        echo "❌ Verifizierung fehlgeschlagen"
      fi
      
      sleep 5
    securityContext:
      privileged: true
      capabilities:
        add:
        - SYS_ADMIN
        - CHOWN
        - DAC_OVERRIDE
        - FOWNER
        - SETGID
        - SETUID
        - SYS_CHROOT
        - MKNOD
        - SYS_MODULE
  restartPolicy: Never

