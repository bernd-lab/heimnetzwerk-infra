apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-cert-manager
  namespace: monitoring
  labels:
    grafana_dashboard: '1'
data:
  cert-manager.json: |
    {
      "title": "Cert-Manager",
      "tags": [
        "cert-manager",
        "tls",
        "certificates"
      ],
      "timezone": "browser",
      "schemaVersion": 16,
      "version": 3,
      "refresh": "30s",
      "panels": [
        {
          "id": 100,
          "type": "text",
          "title": "Cert-Manager Metrics Overview",
          "gridPos": {
            "h": 12,
            "w": 24,
            "x": 0,
            "y": 0
          },
          "options": {
            "content": "# Cert-Manager Dashboard\n\n## ⚠️ HINWEIS\n\n**Die Cert-Manager Metriken sind aktuell nicht verfügbar!**\n\n### Status\n- ❌ `cert_manager_certificate_expiration_timestamp_seconds`: 0 Samples\n- ❌ `cert_manager_certificate_ready_status`: 0 Samples\n- ❌ Cert-Manager wird nicht von Prometheus gescraped\n\n### Mögliche Ursachen\n1. Cert-Manager ist nicht installiert\n2. Metrics-Endpoint ist nicht aktiviert\n3. ServiceMonitor ist nicht korrekt konfiguriert\n4. Prometheus findet den Service nicht\n\n### Lösung\n1. Prüfen Sie, ob Cert-Manager läuft:\n   ```bash\n   kubectl get pods -n cert-manager\n   ```\n\n2. Prüfen Sie, ob Metrics-Port verfügbar ist:\n   ```bash\n   kubectl get svc -n cert-manager\n   ```\n\n3. Prüfen Sie Prometheus Targets:\n   ```bash\n   curl https://prometheus.k8sops.online/api/v1/targets | grep cert-manager\n   ```\n\n4. ServiceMonitor prüfen:\n   ```bash\n   kubectl get servicemonitor -n monitoring cert-manager -o yaml\n   ```\n\n## Erwartete Metriken (wenn verfügbar)\n\n- `cert_manager_certificate_expiration_timestamp_seconds`: Zertifikat-Ablaufzeit\n- `cert_manager_certificate_ready_status`: Zertifikat-Bereitschaftsstatus\n- `cert_manager_certificate_info`: Zertifikat-Informationen\n- `cert_manager_certificate_request_duration_seconds`: Request-Dauer\n",
            "mode": "markdown"
          }
        }
      ]
    }
